<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Knowledge Base - Relationship Therapist</title>
    <link rel="stylesheet" href="/static/css/mirrorcore.css" />
    <link rel="stylesheet" href="/static/css/knowledge.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar glass">
      <div class="nav-content">
        <div class="nav-brand">üß† MirrorCore - Relationship Therapist</div>

        <ul class="nav-menu">
          <li>
            <a href="/dashboard" class="nav-link" data-page="dashboard"
              >Dashboard</a
            >
          </li>
          <li>
            <a href="/chat" class="nav-link" data-page="chat">Chat</a>
          </li>
          <li>
            <a href="/analysis" class="nav-link" data-page="analysis"
              >Analysis</a
            >
          </li>
          <li>
            <a href="/reports" class="nav-link" data-page="reports">Reports</a>
          </li>
          <li>
            <a href="/knowledge" class="nav-link active" data-page="knowledge"
              >Knowledge Base</a
            >
          </li>
        </ul>

        <div class="flex items-center gap-md">
          <div id="connection-status" class="status-indicator status-success">
            <span class="status-dot"></span>
            Connected
          </div>
          <button id="settings-toggle" class="btn btn-ghost">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="3"></circle>
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
              ></path>
            </svg>
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div id="main-container">
      <!-- Knowledge Base Sidebar -->
      <div id="kb-sidebar" class="glass">
        <div id="kb-search-container">
          <div class="input-group">
            <input
              type="text"
              id="kb-search"
              placeholder="Search knowledge base..."
              class="input-field"
            />
            <button id="kb-search-btn" class="btn btn-primary btn-icon">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </button>
          </div>
        </div>

        <div id="kb-categories">
          <h3 class="kb-sidebar-title">Categories</h3>
          <ul class="kb-category-list">
            <li class="kb-category-item active" data-category="all">
              <span class="kb-category-icon">üìö</span>
              <span class="kb-category-label">All Articles</span>
            </li>
            <li class="kb-category-item" data-category="communication">
              <span class="kb-category-icon">üí¨</span>
              <span class="kb-category-label">Communication</span>
            </li>
            <li class="kb-category-item" data-category="conflict_resolution">
              <span class="kb-category-icon">üîÑ</span>
              <span class="kb-category-label">Conflict Resolution</span>
            </li>
            <li class="kb-category-item" data-category="trust">
              <span class="kb-category-icon">üîí</span>
              <span class="kb-category-label">Trust & Commitment</span>
            </li>
            <li class="kb-category-item" data-category="emotional_intimacy">
              <span class="kb-category-icon">‚ù§Ô∏è</span>
              <span class="kb-category-label">Emotional Intimacy</span>
            </li>
          </ul>
        </div>

        <div id="kb-recent">
          <h3 class="kb-sidebar-title">Recently Viewed</h3>
          <ul class="kb-recent-list">
            <!-- Dynamically filled -->
          </ul>
        </div>
      </div>

      <!-- Knowledge Base Content -->
      <div id="kb-content" class="glass">
        <div id="kb-article-list">
          <h2 class="kb-title">Knowledge Base</h2>
          <p class="kb-description">
            Explore our comprehensive collection of relationship resources,
            backed by research and clinical expertise.
          </p>

          <div class="kb-articles-container">
            <div class="kb-loading" id="kb-loading">
              <div class="spinner"></div>
              <span>Loading articles...</span>
            </div>

            <div class="kb-articles" id="kb-articles">
              <!-- Dynamically filled with articles -->
            </div>
          </div>
        </div>

        <div id="kb-article-detail" style="display: none">
          <div class="kb-article-header">
            <button id="kb-back-btn" class="btn btn-ghost">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
              </svg>
              Back to Articles
            </button>

            <div class="kb-article-actions">
              <button id="kb-print-btn" class="btn btn-ghost btn-sm">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="6 9 6 2 18 2 18 9"></polyline>
                  <path
                    d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"
                  ></path>
                  <rect x="6" y="14" width="12" height="8"></rect>
                </svg>
                Print
              </button>
              <button id="kb-share-btn" class="btn btn-ghost btn-sm">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="18" cy="5" r="3"></circle>
                  <circle cx="6" cy="12" r="3"></circle>
                  <circle cx="18" cy="19" r="3"></circle>
                  <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                  <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                </svg>
                Share
              </button>
              <button id="kb-save-btn" class="btn btn-ghost btn-sm">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"
                  ></path>
                </svg>
                Save
              </button>
            </div>
          </div>

          <div id="kb-article-content" class="kb-article-content">
            <!-- Article content will be rendered here -->
          </div>

          <div class="kb-article-footer">
            <div class="kb-article-tags" id="kb-article-tags">
              <!-- Tags will be rendered here -->
            </div>

            <div class="kb-article-feedback">
              <span>Was this article helpful?</span>
              <button class="btn btn-sm btn-outline" id="kb-helpful-yes">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3H14z"
                  ></path>
                  <path d="M7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                </svg>
                Yes
              </button>
              <button class="btn btn-sm btn-outline" id="kb-helpful-no">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3H10z"
                  ></path>
                  <path
                    d="M17 2h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"
                  ></path>
                </svg>
                No
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Panel -->
    <div id="settings-panel" class="glass hidden">
      <div class="settings-header">
        <h3>Settings</h3>
        <button id="close-settings" class="btn btn-ghost btn-icon">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="settings-content">
        <div class="settings-section">
          <h4>AI Provider</h4>
          <div class="form-group">
            <label for="provider-select">Provider</label>
            <select id="provider-select" class="select-field">
              <option value="openai">OpenAI</option>
              <option value="anthropic">Anthropic</option>
              <option value="local">Local Model</option>
              <option value="custom">Custom MCP</option>
            </select>
          </div>

          <div class="form-group">
            <label for="model-select">Model</label>
            <select id="model-select" class="select-field">
              <option value="gpt-4">GPT-4</option>
              <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
              <option value="claude-2">Claude 2</option>
              <option value="claude-instant">Claude Instant</option>
            </select>
          </div>

          <div class="form-group">
            <label for="api-key">API Key</label>
            <div class="input-group">
              <input
                type="password"
                id="api-key"
                placeholder="Enter API key"
                class="input-field"
              />
              <button id="toggle-key" class="btn btn-ghost btn-icon">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
          </div>

          <button id="test-mcp-connection" class="btn btn-secondary">
            Test Connection
          </button>
        </div>

        <div class="settings-section">
          <h4>Knowledge Base</h4>
          <div class="form-group">
            <label for="kb-format">Format</label>
            <select id="kb-format" class="select-field">
              <option value="default">Default Format</option>
              <option value="academic">Academic Research</option>
              <option value="simplified">Simplified Explanations</option>
              <option value="custom">Custom Knowledge Base</option>
            </select>
          </div>

          <div id="custom-kb-container" class="hidden">
            <div class="form-group">
              <label for="custom-kb-url">Custom KB URL</label>
              <input
                type="text"
                id="custom-kb-url"
                placeholder="https://example.com/kb-api"
                class="input-field"
              />
            </div>
            <div class="form-group">
              <label for="custom-kb-key">Authentication Key</label>
              <input
                type="password"
                id="custom-kb-key"
                placeholder="Enter auth key"
                class="input-field"
              />
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h4>Browser Extension</h4>
          <p class="settings-description">
            Install our browser extension to automatically capture relationship
            conversations from social media and messaging platforms.
          </p>
          <button id="install-extension" class="btn btn-primary">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="8 17 12 21 16 17"></polyline>
              <line x1="12" y1="12" x2="12" y2="21"></line>
              <path
                d="M20.88 18.09A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.29"
              ></path>
            </svg>
            Install Extension
          </button>
          <div id="extension-status" class="status-indicator status-warning">
            <span class="status-dot"></span>
            Extension not installed
          </div>
        </div>

        <div class="settings-section">
          <h4>Subscription</h4>
          <div class="subscription-info">
            <div class="subscription-tier">
              <span class="tier-badge free">Free</span>
              <p>Basic features with limited analysis</p>
            </div>
            <button id="upgrade-subscription" class="btn btn-accent">
              Upgrade to Pro
            </button>
          </div>
        </div>
      </div>

      <div class="settings-footer">
        <button id="cancel-settings" class="btn btn-ghost">Cancel</button>
        <button id="save-settings" class="btn btn-primary">Save Changes</button>
      </div>
    </div>

    <!-- Scripts -->
    <script src="/static/js/knowledge.js"></script>
  </body>
</html>
